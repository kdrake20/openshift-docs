// This is included in the following assemblies:
//
// installing_bare_metal_ipi/ipi-install-installation-workflow.adoc

:_content-type: PROCEDURE
[id="configuring-host-network-interfaces-in-the-install-config.yaml-file_{context}"]
= Optional: Configuring host network interfaces in the `install-config.yaml` file

During installation, you can set the `networkConfig` configuration setting in the `install-config.yaml` file to configure host network interfaces using NMState.

[IMPORTANT]
====
Host network interface configuration is set during the installation and provisioning process and includes advanced options such as setting static IPs per host. Before configuring host network interfaces, review the {product-title} 4.10 release notes.
====

.Prerequisites

* Configure a `PTR` DNS record with a valid hostname for each node with a static IP address.

* Install the `jq` package.

.Procedure

. Save the valid `networkConfig` YAML syntax to a file.
. Generate the configuration file for the `networkConfig` YAML file. Run the following command:
+
[source,terminal]
----
$ nmstatectl gc <networkConfig-configuration-file> 
----
+
[NOTE]
====
Consider testing the `networkConfig` YAML syntax before including it in the `install-config.yaml` file. Errors in the YAML syntax might result in a failure to apply the network configuration. Maintain the valid YAML syntax when applying changes using Kubernetes NMState after deployment or when expanding the cluster.
====
+
To use the `networkConfig` configuration setting, create and save the `NMState` configuration within `install-config.yaml`, as shown in the following example:
+
[source,terminal]
----
  hosts:
        - name: openshift-master-0
          role: master
          bmc:
            address: redfish+http://<out_of_band_ip>/redfish/v1/Systems/
            username: <user>
            password: <password>
            disableCertificateVerification: null
          bootMACAddress: <NIC1_mac_address>
          bootMode: UEFI
          rootDeviceHints:
            deviceName: "/dev/sda"
          networkConfig: <1>
            interfaces:
            - name: <NIC1_name>
              type: ethernet
              state: up
              ipv4:
                address:
                - ip: "<IP_address>"
                  prefix-length: 24
                enabled: true
            dns-resolver:
              config:
                server:
                - <DNS_IP_address>
            routes:
              config:
              - destination: 0.0.0.0/0
                next-hop-address: <IP_address>
                next-hop-interface: <NIC1_name>
----
<1> Add NMState YAML syntax to configure host interfaces.
+
[IMPORTANT]
====
Once deployed, you cannot modify the `networkConfig` configuration setting of `install-config.yaml` file to make changes to the host network interface. Use the Kubernetes NMState Operator to make changes to the host network interface after deployment.
====
+
In the case of deploying {product-title} without a DHCP server on bare-metal network, use the following procedure to configure a static IP address for the bootstrap VM using Ignition:
+
. Create the `bootstrap_config.sh` file:
+
[source,terminal]
----
$ cat bootstrap_config.sh
#!/bin/bash
BOOTSTRAP_CONFIG="[connection]
type=ethernet
interface-name=ens3
[ethernet]
[ipv4]
method=manual
addresses=192.168.123.101/24
gateway=192.168.123.1
dns=192.168.123.1"
cat > bootstrap_network_config.ign << EOF
{
  "path": "/etc/NetworkManager/system-connections/ens3.nmconnection",
  "mode": 384,
  "contents": {
    "source": "data:text/plain;charset=utf-8;base64,$(echo "${BOOTSTRAP_CONFIG}" | base64 -w 0)"
  }
}
EOF
----
+
. Run `bootstrap_config.sh` to create the `json` configuration file:
+
[source,terminal]
----
$ ./bootstrap_config.sh
----
+
. Optional: Create a backup of the original `bootstrap.ign` file:
+
[source,terminal]
----
$ mv clusterconfigs/bootstrap.ign clusterconfigs/bootstrap.ign.orig
----
+
. Inject the Ignition file into the configuration:
+
[source,terminal]
----
$ jq '.storage.files += $input' clusterconfigs/bootstrap.ign.orig --slurpfile input bootstrap_network_config.ign (output of bootstrap_config.sh) > clusterconfigs/bootstrap.ign
----